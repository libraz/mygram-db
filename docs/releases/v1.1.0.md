# MygramDB v1.1.0 Release Notes

**Release Date**: 2025-11-17
**Previous Version**: v1.0.0
**Commits**: 33 commits
**Files Changed**: 211 files (+34,598 insertions, -4,346 deletions)

## ‚ö†Ô∏è BREAKING CHANGES

### 1. Query Syntax Change: ORDER BY ‚Üí SORT

**Impact**: `ORDER BY` syntax is **deprecated** and will show error messages.

**Migration Required**:

```
# Old syntax (deprecated)
SEARCH "keyword" ORDER BY id DESC LIMIT 100

# New syntax (required)
SEARCH "keyword" SORT -id LIMIT 100
```

**Why**: More concise syntax, better readability.

**Migration**: Update all queries using ORDER BY to use SORT. The server will return helpful error messages guiding the migration.

### 2. Dump Commands Restructured: SAVE/LOAD ‚Üí DUMP SAVE/LOAD

**Impact**: Old `SAVE` and `LOAD` commands are **removed**.

**Migration Required**:

```
# Old syntax (removed)
SAVE /path/to/snapshot
LOAD /path/to/snapshot

# New syntax (required)
DUMP SAVE /path/to/dump.dmp
DUMP LOAD /path/to/dump.dmp
DUMP VERIFY /path/to/dump.dmp
DUMP INFO /path/to/dump.dmp
```

**New Features**:
- Integrity verification with CRC32 checksums
- Metadata inspection without loading
- Versioned binary format (.dmp files)

### 3. Configuration Change: replication.state_file Removed

**Impact**: `replication.state_file` configuration option is **removed** (auto-managed internally).

**Migration**: Remove this option from your config.yaml - the server now manages replication state automatically.

**Before (v1.0.0)**:
```yaml
replication:
  state_file: "/var/lib/mygramdb/replication.state"
```

**After (v1.1.0)**:
```yaml
replication:
  # state_file removed - auto-managed
  host: "mysql-host"
  port: 3306
```

### 4. LIMIT Syntax Enhancement: MySQL-Compatible Offset

**Not breaking**: Old `LIMIT count` still works, but new `LIMIT offset,count` is recommended.

```
# Both work in v1.1.0
SEARCH "keyword" LIMIT 100              # Old: first 100 results
SEARCH "keyword" LIMIT 10,100           # New: skip 10, return 100 (MySQL-compatible)
```

---

## Version Recommendation: v1.1.0

This is the first production-ready tagged release of MygramDB with comprehensive features and significant improvements over v1.0.0:

- **New features**: Query caching, network ACL, Prometheus metrics, automatic dump saves
- **Security**: MySQL SSL/TLS support, input validation, DoS protection
- **Performance**: Cache system with n-gram invalidation, optimized PostingList
- **API enhancements**: New syntax (SORT, SYNC), COUNT caching, client library improvements
- **Operations**: RPM packaging, GitHub Actions release workflow

---

## üöÄ New Features

### Query Caching System

- **Result Cache**: N-gram based query result caching
  - Intelligent invalidation based on document changes
  - Cache key normalization for query variations
  - MD5-based cache key generation
  - Result compression for memory efficiency
  - Commit: `eeaebee`

- **COUNT Query Caching**: Dedicated caching for COUNT queries
  - Separate cache for count results
  - OFFSET/LIMIT applied correctly to cache hits
  - Commit: `eaaadef`

### Security Features

- **Network Access Control**: CIDR-based IP filtering
  - Allow/deny specific IP ranges
  - Configuration: `network.allow_cidrs`
  - Production security best practice
  - Commit: `8c0ba33`

- **MySQL SSL/TLS Support**: Secure database connections
  - SSL/TLS encryption for replication
  - Certificate verification options
  - Commit: `8cea4a5`

- **Input Validation**: Query length limits and sanitization
  - Prevent excessively long queries
  - Input sanitization for security
  - Commit: `d15634a`

- **DoS Protection**: Bounds checking in data loaders
  - Prevent malicious dump files
  - Document loader validation
  - Commit: `87333cf`

### Operational Features

- **Automatic Dump Saves**: Periodic backup functionality
  - Configurable save intervals
  - Automatic snapshot creation
  - Commit: `ddbe685`

- **SYNC Command**: Manual table synchronization
  - Force immediate sync from MySQL
  - Useful for troubleshooting
  - Commit: `69265fc`

- **Prometheus Metrics**: Comprehensive monitoring endpoint
  - `/metrics` endpoint for Prometheus scraping
  - Query performance metrics
  - Cache hit/miss rates
  - Replication lag tracking
  - Commit: `559c2ea`

- **Memory Monitoring**: Enhanced memory tracking
  - Real-time memory usage reporting
  - OPTIMIZE command safety improvements
  - Commit: `93eec4e`

### API Enhancements

- **New Query Syntax**: SORT and LIMIT improvements
  - `SORT id` or `SORT -id` for ordering
  - `LIMIT offset,count` syntax support
  - Replaced ORDER BY with SORT (backward compatible)
  - Commit: `82bd058`

- **Client Library Updates**: Enhanced API
  - Updated to use SORT syntax
  - Improved error handling
  - Better binlog test coverage
  - Commit: `950e38e`

- **Primary Key Validation**: Table sync validation
  - Ensure tables have primary keys
  - Prevent sync issues
  - Commit: `c0287ba`

### Configuration System

- **Runtime Configuration Help**: Interactive help system
  - `--help-config` option
  - Detailed configuration documentation
  - Example values and descriptions
  - Commit: `e9d950d`

- **Configurable Default LIMIT**: Query result limits
  - Prevent accidental full table scans
  - Configurable default and maximum limits
  - Commit: `5f89c8d`

### Release Infrastructure

- **RPM Packaging**: Official RPM packages
  - AlmaLinux/RHEL/Rocky Linux support
  - Multi-architecture builds
  - Commit: `fd612c7`

- **GitHub Actions Release Workflow**: Automated releases
  - Automatic RPM builds on tags
  - GitHub Release creation
  - Asset uploads
  - Commit: `fd612c7`

---

## üèóÔ∏è Architectural Improvements

### Server Architecture

- **Component Extraction**: Modular server design
  - Separated ConnectionAcceptor
  - Isolated ConnectionIOHandler
  - Command handlers (Search, Document, Dump, Sync, Admin, Debug, Cache, Replication)
  - Better separation of concerns
  - Commit: `439fe46`, `dc11a67`

### Cache Architecture

- **CacheManager**: Centralized cache coordination
  - Unified cache access
  - Cache key management
  - Statistics tracking
  - Commit: `4b94225`

- **InvalidationManager**: Smart cache invalidation
  - N-gram based invalidation
  - Efficient queue processing
  - Minimal false positives
  - Commit: `4b94225`

### Storage System

- **Unified Dump Management**: Replaced snapshot system
  - Single dump format
  - Improved save/load reliability
  - Better error handling
  - Commit: `ff27e9f`

---

## ‚ö° Performance Optimizations

### Index Optimization

- **PostingList Improvements**: Faster bitmap operations
  - Optimized Roaring bitmap usage
  - Reduced memory allocations
  - Commit: `aaa1be8`

### CI/CD Performance

- **Parallel Test Execution**: Faster CI builds
  - Concurrent test execution
  - Build caching
  - Reduced CI time by ~40%
  - Commits: `070c890`, `3cf2f4c`

---

## üêõ Bug Fixes

### Critical Fixes

- **Concurrency Issues**: Thread safety improvements
  - Fixed race conditions in cache
  - Memory safety fixes
  - Thread handling improvements
  - Commit: `e5bfe3b`

- **Test Parallelism**: Resolved test hangs
  - Fixed deadlocks in concurrent tests
  - Improved test stability
  - Commit: `14c5492`

- **Cache Bugs**: Multiple cache-related fixes
  - OFFSET/LIMIT application
  - Cache invalidation timing
  - Commit: `b6744e3`, `eaaadef`

### Minor Fixes

- **Build System**: Missing include for PATH_MAX
  - Added climits header
  - Commit: `4898c2d`

- **Server Shutdown**: Graceful shutdown improvements
  - Proper resource cleanup
  - Thread synchronization
  - Commit: `aaa1be8`

---

## üìù Documentation

### New Documentation

- **Snapshot Guide**: Bilingual (EN/JA)
  - `docs/{en,ja}/snapshot.md`
  - Dump save/load procedures
  - Backup strategies

- **SYNC Command Guide**: Bilingual (EN/JA)
  - `docs/{en,ja}/sync_command.md`
  - Manual synchronization usage
  - Troubleshooting

### Updated Documentation

- **Configuration Guide**: Expanded options
  - Network ACL configuration
  - Cache settings
  - Security options
  - Prometheus metrics

- **Query Syntax Guide**: New syntax
  - SORT syntax documentation
  - LIMIT offset,count examples
  - Filter operators

- **HTTP API Reference**: New endpoints
  - `/metrics` endpoint
  - Cache statistics
  - Health check details

- **Protocol Reference**: Updated commands
  - SYNC command
  - Cache-related commands
  - Updated syntax

---

## üîß Configuration Changes

### New Configuration Options

```yaml
# Network Access Control
network:
  allow_cidrs:
    - "0.0.0.0/0"  # Default: allow all (v1.1.0)

# Query Cache
cache:
  enable: true
  max_size_mb: 1024
  ttl_seconds: 3600
  invalidation_queue_size: 10000

# Automatic Dumps
dump:
  auto_save:
    enable: true
    interval_seconds: 3600
    path: "/var/lib/mygramdb/dumps"

# Query Limits
query:
  default_limit: 100
  max_limit: 10000
  max_query_length: 10000

# MySQL SSL/TLS
mysql:
  ssl:
    enable: false
    ca_cert: "/path/to/ca.pem"
    client_cert: "/path/to/client-cert.pem"
    client_key: "/path/to/client-key.pem"
    verify_server_cert: true

# Prometheus Metrics
prometheus:
  enable: true
  path: "/metrics"
```

---

## üìä Statistics

### Code Changes

- **Total Commits**: 33
- **Files Changed**: 211
- **Insertions**: +34,598 lines
- **Deletions**: -4,346 lines
- **Net Change**: +30,252 lines

### Module Breakdown

| Module | Major Changes |
|--------|---------------|
| Cache | New cache system with 10+ files |
| Server | Component extraction, handlers |
| Config | Help system, new options |
| Documentation | 2,000+ lines added |
| Tests | Comprehensive test coverage |
| CI/CD | GitHub Actions, RPM packaging |

### Test Coverage

- **Total Tests**: 1,000+ tests
- **New Tests**: ~300 tests added
- **Test Categories**:
  - Cache tests: ~100
  - Server component tests: ~80
  - Integration tests: ~50
  - Security tests: ~30

---

## üîÑ Migration Guide

### From v1.0.0 to v1.1.0

#### 1. Network ACL Configuration (Optional)

v1.1.0 introduces network ACL but defaults to allowing all connections (backward compatible).

```yaml
# Optional: Restrict access to specific networks
network:
  allow_cidrs:
    - "10.0.0.0/8"
    - "192.168.0.0/16"
```

#### 2. Enable Query Cache (Recommended)

```yaml
cache:
  enable: true
  max_size_mb: 1024  # Adjust based on available RAM
  ttl_seconds: 3600
```

#### 3. Configure Automatic Dumps (Recommended)

```yaml
dump:
  auto_save:
    enable: true
    interval_seconds: 3600  # Save every hour
    path: "/var/lib/mygramdb/dumps"
```

#### 4. Update Query Syntax (Optional)

Old syntax still works, but new syntax is recommended:

```
# Old (still works)
SEARCH "query" ORDER BY id DESC LIMIT 100

# New (recommended)
SEARCH "query" SORT -id LIMIT 100
```

#### 5. Enable Prometheus Metrics (Optional)

```yaml
prometheus:
  enable: true
```

Access metrics at `http://localhost:8080/metrics`

---

## üôè Acknowledgments

This release establishes MygramDB as a production-ready full-text search engine with:

- **Caching**: Dramatically improved query performance with intelligent invalidation
- **Security**: Network ACL, SSL/TLS, input validation, DoS protection
- **Monitoring**: Prometheus metrics for operational visibility
- **Reliability**: Automatic dumps, improved error handling, better test coverage
- **Packaging**: Official RPM distribution for easy deployment

---

## üìã Full Commit List

```
4898c2d fix: Add missing climits include for PATH_MAX in daemon_utils_test
fd612c7 feat: Add RPM packaging and GitHub Actions release workflow
eaaadef fix(cache): Apply OFFSET/LIMIT to cache hits and implement COUNT caching
3cf2f4c perf(ci): Optimize CI pipeline and resolve code quality issues
e5bfe3b fix: Resolve critical bugs in concurrency, memory safety, and thread handling
14c5492 fix: Resolve test parallelism issues causing hangs and improve stability
b6744e3 fix: Resolve critical bugs in cache, MySQL, and concurrency handling
070c890 perf(ci): Optimize CI pipeline with caching and parallel test execution
7065524 refactor: Format long send() call in ConnectionIOHandler for readability
4b94225 refactor: Enhance cache architecture, client reliability, and HTTP server functionality
2cbab24 refactor: Improve code quality and fix linting issues across codebase
439fe46 refactor(server): Extract responsibilities from TcpServer and integrate new classes
87333cf fix: Add bounds checking to prevent DoS attacks in dump/document loaders
c0287ba feat: add primary key validation for table synchronization
8cea4a5 feat: Add security enhancements and MySQL SSL/TLS support
aaa1be8 refactor: Optimize PostingList and improve server shutdown handling
8c0ba33 feat: Add network access control with CIDR-based IP filtering
3e67e10 refactor: Move config test mode check before directory verification
d15634a feat: Add query length validation and input sanitization
f73cc6b refactor: Improve code quality and build system organization
e9d950d feat: Add runtime configuration help system
dc11a67 refactor: Restructure server architecture with isolated components
950e38e feat: Update client library API to use SORT syntax and enhance binlog tests
69265fc feat: Add SYNC command for manual table synchronization
eeaebee feat: Add query result cache with n-gram based invalidation
de0a535 fix: Improve dump handler thread safety and exception handling
559c2ea feat: Add Prometheus metrics endpoint for comprehensive monitoring
93eec4e feat: Add comprehensive memory monitoring and optimize OPTIMIZE command safety
82bd058 refactor: Replace ORDER BY with SORT syntax and add LIMIT offset,count support
145b650 refactor: Improve code quality in tcp_server.cpp
ddbe685 feat: Add automatic dump save functionality with periodic backups
ff27e9f refactor: Replace snapshot system with unified dump management
5f89c8d feat: Add configurable default LIMIT and improve SAVE error handling
```

---

**Release Tag**: `git tag -a v1.1.0 -m "MygramDB v1.1.0: Production-ready release with caching, security, and monitoring"`
