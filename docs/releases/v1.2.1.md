# MygramDB v1.2.1 Release Notes

**Release Date:** 2025-11-19
**Type:** Patch Release (Bug Fixes & Docker Improvements)

---

## Overview

Version 1.2.1 is a patch release that fixes Docker environment issues and improves MySQL 8.4 compatibility. This release primarily addresses user experience issues when deploying with Docker.

## What's Fixed

### Docker Network ACL Configuration

**Problem:** Users experienced connection refused errors when using Docker without custom configuration files, because the `NETWORK_ALLOW_CIDRS` environment variable was not supported.

**Solution:** Added `NETWORK_ALLOW_CIDRS` environment variable support to the Docker entrypoint script.

```bash
# Now you can easily configure network ACL via environment variable
docker run -d \
  -e NETWORK_ALLOW_CIDRS=0.0.0.0/0 \
  -e MYSQL_HOST=mysql \
  # ... other env vars
  ghcr.io/libraz/mygram-db:latest
```

**Features:**
- Supports comma-separated CIDR list: `10.0.0.0/8,172.16.0.0/12`
- Default value: `0.0.0.0/0` (allow all) for development convenience
- Automatically converts to YAML format in generated config file

### MySQL 8.4 Compatibility

**Problem:** `docker-compose.yml` used the deprecated `--default-authentication-plugin` option, which was removed in MySQL 8.4.

**Solution:** Updated to use the correct MySQL 8.4 option `--mysql-native-password=ON`.

```yaml
# Before (deprecated in MySQL 8.4)
- --default-authentication-plugin=mysql_native_password

# After (MySQL 8.4 compatible)
- --mysql-native-password=ON
```

## What's New

### RPM Testing Environment

Added a comprehensive testing environment for RPM packages in `support/testing/`:

- **Dockerfile.rpm-test:** Rocky Linux 9 based container for testing RPM packages
- **docker-compose.rpm-test.yml:** Complete test environment with MySQL 8.4
- **config-rpm-test.yaml:** Test configuration with proper network ACL settings
- **README.md:** Documentation for using the test environment

This environment allows developers to test RPM packages in a Docker environment that closely matches production deployments.

## Configuration Improvements

### Example Configuration Files

**Problem:** Example configuration files (YAML and JSON) had inconsistent defaults and were missing important fields.

**Solution:** Aligned all example configuration files with consistent, secure defaults:

**Network ACL (easier initial setup):**
- Changed `allow_cidrs` from `127.0.0.1/32` to `0.0.0.0/0` for easier initial setup
- Added clear warnings about restricting in production environments

**JSON consistency fixes (align with YAML):**
- Added `mysql.ssl_enable: false` (was missing in JSON)
- Changed `dump.interval_sec` from `600` to `0` (disable auto-save by default)
- Changed `api.http.enable` from `true` to `false` (more secure default)
- Added `logging.file: ""` (explicit stdout specification)

All example files now have consistent defaults between YAML and JSON formats.

## Documentation Improvements

### Security Warnings

Added security warnings and best practices for network ACL configuration:

- **README.md:** Added security note about `NETWORK_ALLOW_CIDRS` in Quick Start
- **docs/en/docker-deployment.md:** Added comprehensive Network Configuration section with examples
- **docs/en/configuration.md:** Added Docker environment variable examples

### Production Examples

```bash
# Development (allow all)
NETWORK_ALLOW_CIDRS=0.0.0.0/0

# Production (restrict to specific networks)
NETWORK_ALLOW_CIDRS=10.0.0.0/8,172.16.0.0/12

# Production (single application server)
NETWORK_ALLOW_CIDRS=192.168.1.100/32
```

## Technical Changes

### `.gitignore` Update

Updated `.gitignore` to use `/Testing/` instead of `Testing/` to avoid excluding the `support/testing` directory while still ignoring CMake's `Testing/` output directory.

## Migration Guide

### From v1.2.0

**No breaking changes.** This is a drop-in replacement for v1.2.0.

If you're using Docker:

1. Pull the latest image:
   ```bash
   docker pull ghcr.io/libraz/mygram-db:v1.2.1
   ```

2. (Optional) Add `NETWORK_ALLOW_CIDRS` to your docker-compose.yml or docker run command for easier configuration

3. If using docker-compose with MySQL 8.4, the MySQL configuration is now compatible

### For New Users

Follow the standard installation guide. The network ACL is now properly configured by default for Docker users.

## Known Issues

None.

## Contributors

- @libraz

## Links

- [Full Changelog](https://github.com/libraz/mygram-db/compare/v1.2.0...v1.2.1)
- [Docker Image](https://github.com/libraz/mygram-db/pkgs/container/mygram-db)
- [Installation Guide](../../docs/en/installation.md)
- [Docker Deployment Guide](../../docs/en/docker-deployment.md)

---

**Questions or Issues?**
Please open an issue on [GitHub Issues](https://github.com/libraz/mygram-db/issues)
